ì¢‹ìŠµë‹ˆë‹¤!  
ìš”ì²­í•˜ì‹  íë¦„ì€ ì•½ê°„ ë³µí•©ì ì´ì§€ë§Œ, ì‹¤ì œ **Kafka + DB ì¡°íšŒ + ê°€ê³µ + ì €ì¥** í”„ë¡œì„¸ìŠ¤ì—ì„œ ì•„ì£¼ ë§ì´ ì“°ì´ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.  

ì •í™•í•œ ìš”ì²­ì„ ë‹¤ì‹œ ìš”ì•½í•˜ë©´:

---
# ğŸŒŸ ìš”ì²­ ì‹œë‚˜ë¦¬ì˜¤ ìš”ì•½

1. Kafka ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹  â†’ **VO1** ì— ë‹´ìŒ  
2. ì´ VO1ì˜ ê°’ìœ¼ë¡œ DBì—ì„œ JOIN ì¿¼ë¦¬ ì¡°íšŒ â†’ **VO2**ë¡œ ê²°ê³¼ ë°›ìŒ  
3. VO1 + VO2ë¥¼ ì¡°í•©í•´ì„œ ì¶”ê°€ ë°ì´í„° ìƒì„± â†’ **DTO**ë¡œ ì¡°ë¦½  
4. DTOë¥¼ **Entity**ë¡œ ë³€í™˜í•´ì„œ ìµœì¢…ì ìœ¼ë¡œ **DB ì €ì¥**

---
# ğŸ“¦ ì „ì²´ í”Œë¡œìš°

```plaintext
Kafka ë©”ì‹œì§€ ìˆ˜ì‹ 
â†“
VO1 ìƒì„± (ìˆ˜ì‹  ë©”ì‹œì§€ VO)
â†“
DB JOIN ì¡°íšŒ
â†“
VO2 ìƒì„± (ì¡°ì¸ ê²°ê³¼ VO)
â†“
VO1 + VO2 í•©ì³ì„œ DTO ìƒì„±
â†“
DTO â†’ Entity ë³€í™˜
â†“
DB ì €ì¥
```

---

# ğŸ”¥ ì˜ˆì œ ì„¤ê³„

### ğŸ“„ 1. Kafka ìˆ˜ì‹  ë©”ì‹œì§€ (JSON)

```json
{
  "userId": 10,
  "productId": 200
}
```

- userIdì™€ productIdë¥¼ ë°›ëŠ”ë‹¤.
- ì—¬ê¸°ì„œ userIdë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ê°€ ì •ë³´ë¥¼ ì¡°íšŒí•  ê²ƒì´ë‹¤.

---

### ğŸ“„ 2. VO1: Kafka ìˆ˜ì‹ ìš© (`PurchaseRequestVo.java`)

```java
package com.example.vo;

import lombok.Getter;

@Getter
public class PurchaseRequestVo {
    private final Long userId;
    private final Long productId;

    public PurchaseRequestVo(Long userId, Long productId) {
        this.userId = userId;
        this.productId = productId;
    }
}
```

âœ… Kafka ìˆ˜ì‹  ë©”ì‹œì§€ë¥¼ ë‹´ëŠ” VOì…ë‹ˆë‹¤.

---

### ğŸ“„ 3. DB JOIN ì¡°íšŒ ì¿¼ë¦¬ ê²°ê³¼ VO2 (`UserInfoVo.java`)

```java
package com.example.vo;

import lombok.Getter;

@Getter
public class UserInfoVo {
    private final String username;
    private final String membershipLevel;

    public UserInfoVo(String username, String membershipLevel) {
        this.username = username;
        this.membershipLevel = membershipLevel;
    }
}
```

âœ… userIdë¡œ users í…Œì´ë¸”ì„ ì¡°íšŒí•œ ê²°ê³¼ì…ë‹ˆë‹¤.

---

### ğŸ“„ 4. DTO: ê°€ê³µ + ì¶”ê°€ ë³€ìˆ˜ (`PurchaseDto.java`)

```java
package com.example.dto;

import lombok.Builder;
import lombok.Getter;

@Getter
@Builder
public class PurchaseDto {
    private final Long userId;
    private final Long productId;
    private final String username;
    private final String membershipLevel;
    private final String purchaseStatus; // ğŸ’¥ ì¶”ê°€ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ë³€ìˆ˜
}
```
âœ… DB ì¡°íšŒ ê²°ê³¼ì™€ Kafka ìˆ˜ì‹  ê²°ê³¼ë¥¼ í•©ì¹œ + ì¶”ê°€ ë°ì´í„°(purchaseStatus)ê¹Œì§€ ë‹´ëŠ” DTOì…ë‹ˆë‹¤.

---

### ğŸ“„ 5. Entity: ìµœì¢… DB ì €ì¥ìš© (`PurchaseEntity.java`)

```java
package com.example.entity;

import jakarta.persistence.*;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Entity
@Table(name = "purchases")
@Getter
@Setter
@NoArgsConstructor
public class PurchaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private Long userId;
    private Long productId;
    private String username;
    private String membershipLevel;
    private String purchaseStatus;
}
```

âœ… DBì— ì €ì¥ë  ìµœì¢… Entityì…ë‹ˆë‹¤.

---

# ğŸ› ï¸ Mapper (MapStruct ì‚¬ìš©)

**PurchaseMapper.java**

```java
package com.example.mapper;

import com.example.dto.PurchaseDto;
import com.example.entity.PurchaseEntity;
import org.mapstruct.Mapper;
import org.mapstruct.factory.Mappers;

@Mapper(componentModel = "spring")
public interface PurchaseMapper {

    PurchaseMapper INSTANCE = Mappers.getMapper(PurchaseMapper.class);

    PurchaseEntity toEntity(PurchaseDto dto);
}
```
âœ… DTOë¥¼ Entityë¡œ ë³€í™˜í•˜ëŠ” Mapperì…ë‹ˆë‹¤.

---

# ğŸ”¥ Kafka Listener

**PurchaseKafkaListener.java**

```java
package com.example.kafka;

import com.example.dto.PurchaseDto;
import com.example.entity.PurchaseEntity;
import com.example.mapper.PurchaseMapper;
import com.example.repository.PurchaseRepository;
import com.example.service.UserInfoService;
import com.example.vo.PurchaseRequestVo;
import com.example.vo.UserInfoVo;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Component;

@Slf4j
@Component
@RequiredArgsConstructor
public class PurchaseKafkaListener {

    private final ObjectMapper objectMapper;
    private final UserInfoService userInfoService;
    private final PurchaseRepository purchaseRepository;
    private final PurchaseMapper purchaseMapper;

    @KafkaListener(topics = "purchase.request", groupId = "purchase-group")
    public void listen(String message) {
        try {
            // 1. Kafka ë©”ì‹œì§€ ìˆ˜ì‹  â†’ VO1 ìƒì„±
            PurchaseRequestVo requestVo = objectMapper.readValue(message, PurchaseRequestVo.class);

            // 2. userIdë¡œ DB ì¡°íšŒ â†’ VO2 ìƒì„±
            UserInfoVo userInfoVo = userInfoService.findUserInfoByUserId(requestVo.getUserId());

            // 3. VO1 + VO2 + ì¶”ê°€ ë°ì´í„°ë¡œ DTO ìƒì„±
            PurchaseDto purchaseDto = PurchaseDto.builder()
                    .userId(requestVo.getUserId())
                    .productId(requestVo.getProductId())
                    .username(userInfoVo.getUsername())
                    .membershipLevel(userInfoVo.getMembershipLevel())
                    .purchaseStatus("REQUESTED") // ì¶”ê°€ ìƒíƒœ
                    .build();

            // 4. DTO â†’ Entity ë³€í™˜
            PurchaseEntity entity = purchaseMapper.toEntity(purchaseDto);

            // 5. DB ì €ì¥
            purchaseRepository.save(entity);

            log.info("Purchase saved: {}", entity.getId());

        } catch (Exception e) {
            log.error("Error processing purchase request: {}", message, e);
        }
    }
}
```

---

# ğŸ“š UserInfoService (DB ì¡°íšŒìš©)

```java
package com.example.service;

import com.example.mapper.UserInfoQueryMapper;
import com.example.vo.UserInfoVo;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class UserInfoService {

    private final UserInfoQueryMapper userInfoQueryMapper;

    public UserInfoVo findUserInfoByUserId(Long userId) {
        return userInfoQueryMapper.findByUserId(userId);
    }
}
```

---

# ğŸ“„ MyBatis Mapper (DB ì¡°íšŒìš©)

**UserInfoQueryMapper.java**

```java
@Mapper
public interface UserInfoQueryMapper {
    UserInfoVo findByUserId(Long userId);
}
```

**UserInfoQueryMapper.xml**

```xml
<mapper namespace="com.example.mapper.UserInfoQueryMapper">

    <select id="findByUserId" resultType="com.example.vo.UserInfoVo">
        SELECT 
            u.username,
            m.level AS membershipLevel
        FROM users u
        JOIN memberships m ON u.id = m.user_id
        WHERE u.id = #{userId}
    </select>

</mapper>
```

---

# âœ… ìµœì¢… ì „ì²´ íë¦„ ìš”ì•½

```plaintext
1. Kafka ë©”ì‹œì§€ ìˆ˜ì‹  â†’ VO1 ìƒì„± (PurchaseRequestVo)
2. DB JOIN ì¡°íšŒ â†’ VO2 ìƒì„± (UserInfoVo)
3. VO1 + VO2 + ì¶”ê°€ ë°ì´í„° â†’ DTO ìƒì„± (PurchaseDto)
4. DTO â†’ Entity ë³€í™˜ (PurchaseEntity)
5. DB ì €ì¥
```

---

# âœ¨ í•µì‹¬ ì •ë¦¬

| êµ¬ë¶„ | ëª©ì  |
|:---|:---|
| **VO1** | Kafka ìˆ˜ì‹  ë°ì´í„° ë‹´ê¸° |
| **VO2** | DB ì¡°íšŒ ê²°ê³¼ ë‹´ê¸° |
| **DTO** | VO1+VO2 í•©ì³ì„œ ê°€ê³µ ë° ì¶”ê°€ ë°ì´í„° ì„¸íŒ… |
| **Entity** | ìµœì¢… DB ì €ì¥ìš© ê°ì²´ |
| **Mapper** | VOâ†’DTO, DTOâ†’Entity ë³€í™˜ ìë™í™” |

---

# ğŸ”¥ ìµœì¢… í•œ ì¤„ ìš”ì•½

> **Kafka ìˆ˜ì‹  ë°ì´í„° + DB ì¡°íšŒ ë°ì´í„° â†’ DTOë¡œ ê°€ê³µ â†’ Entity ë³€í™˜ â†’ DB ì €ì¥.**  
>  
> ì´ë ‡ê²Œ ê³„ì¸µë³„ë¡œ ë‚˜ëˆ„ë©´ ì½”ë“œê°€ ê¹”ë”í•˜ê³  í™•ì¥ì„±, ìœ ì§€ë³´ìˆ˜ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.

---

# â¡ï¸ ì¶”ê°€ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ê³ ê¸‰ ì£¼ì œ

- Kafka Listenerì—ì„œ ìˆ˜ì‹  ì‹¤íŒ¨ ì‹œ Retry/Dead Letter ì²˜ë¦¬í•˜ê¸°
- MapStructì—ì„œ ë³µí•© VO â†’ DTO ë³€í™˜(ë‹¤ì¤‘ Source ë§¤í•‘) ì²˜ë¦¬í•˜ê¸°
- Kafka ìˆ˜ì‹  ë°ì´í„°ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë‹¤ë¥¸ DB ì¡°íšŒí•˜ëŠ” ë°©ë²•

---
=======================================================================================================================

ì¢‹ìŠµë‹ˆë‹¤! ğŸ”¥  
ì´ë²ˆì—ëŠ” ì•½ì†ëŒ€ë¡œ **ì—¬ëŸ¬ VOë¥¼ í•©ì³ì„œ í•˜ë‚˜ì˜ DTOë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•**,  
ì¦‰ **ë³µí•© VO â†’ DTO ë§¤í•‘ (ë‹¤ì¤‘ Source ë§¤í•‘)**ì„  
**MapStruct ê³ ê¸‰ ê¸°ëŠ¥**ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ë³´ì—¬ë“œë¦´ê²Œìš”!

---

# ğŸŒŸ ëª©í‘œ
- Kafkaë¡œ ë°›ì€ **VO1**  
- DB ì¡°íšŒí•´ì„œ ì–»ì€ **VO2**
- ì´ ë‘˜ì„ **í•˜ë‚˜ì˜ DTO**ë¡œ í•©ì³ì„œ ë§Œë“ ë‹¤.
- ì´ ê³¼ì •ì„ **MapStruct**ë¥¼ ì´ìš©í•´ì„œ ìë™í™”í•œë‹¤.

---

# ğŸ“š ì˜ˆì œ ì„¤ì •

### ìˆ˜ì‹  VO1 (`PurchaseRequestVo`)
```java
@Getter
@AllArgsConstructor
public class PurchaseRequestVo {
    private final Long userId;
    private final Long productId;
}
```
- Kafka ë©”ì‹œì§€ì—ì„œ ë°›ìŒ

---

### ì¡°íšŒ VO2 (`UserInfoVo`)
```java
@Getter
@AllArgsConstructor
public class UserInfoVo {
    private final String username;
    private final String membershipLevel;
}
```
- userIdë¡œ DB ì¡°íšŒí•´ì„œ ì–»ìŒ

---

### ìµœì¢… ë§Œë“¤ DTO (`PurchaseDto`)
```java
@Getter
@Builder
public class PurchaseDto {
    private final Long userId;
    private final Long productId;
    private final String username;
    private final String membershipLevel;
    private final String purchaseStatus; // ì¶”ê°€ ê°€ê³µ í•„ë“œ
}
```

---
# ğŸ”¥ ì—¬ê¸°ê¹Œì§€ íë¦„ ìš”ì•½

```plaintext
VO1 (PurchaseRequestVo) + VO2 (UserInfoVo)
â†“
PurchaseDto
```

---

# 1. MapStruct ë³µí•© ë§¤í•‘ Mapper ë§Œë“¤ê¸°

**PurchaseObjectMapper.java**

```java
package com.example.mapper;

import com.example.dto.PurchaseDto;
import com.example.vo.PurchaseRequestVo;
import com.example.vo.UserInfoVo;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.factory.Mappers;

@Mapper(componentModel = "spring")
public interface PurchaseObjectMapper {

    PurchaseObjectMapper INSTANCE = Mappers.getMapper(PurchaseObjectMapper.class);

    @Mapping(source = "purchaseRequestVo.userId", target = "userId")
    @Mapping(source = "purchaseRequestVo.productId", target = "productId")
    @Mapping(source = "userInfoVo.username", target = "username")
    @Mapping(source = "userInfoVo.membershipLevel", target = "membershipLevel")
    // purchaseStatusëŠ” ë‚˜ì¤‘ì— ë³„ë„ë¡œ ì„¸íŒ… (builder pattern)
    PurchaseDto toDto(PurchaseRequestVo purchaseRequestVo, UserInfoVo userInfoVo);
}
```

âœ… í¬ì¸íŠ¸ëŠ”:
```java
toDto(PurchaseRequestVo purchaseRequestVo, UserInfoVo userInfoVo);
```
**â†’ ë§¤ê°œë³€ìˆ˜ 2ê°œë¥¼ ë™ì‹œì— ë°›ì•„ì„œ í•˜ë‚˜ì˜ DTOë¥¼ ìƒì„±í•©ë‹ˆë‹¤!**

ê·¸ë¦¬ê³  ê°ê° ì–´ë–¤ í•„ë“œì—ì„œ ì–´ë–¤ DTO í•„ë“œë¡œ ë§¤í•‘í• ì§€ `@Mapping`ìœ¼ë¡œ ëª…í™•íˆ ì§€ì •í•´ì¤ë‹ˆë‹¤.

---

# 2. Service ì½”ë“œì—ì„œ ì‚¬ìš© ì˜ˆì‹œ

```java
@Service
@RequiredArgsConstructor
public class PurchaseService {

    private final PurchaseObjectMapper purchaseObjectMapper;

    public PurchaseDto buildPurchaseDto(PurchaseRequestVo requestVo, UserInfoVo userInfoVo) {
        PurchaseDto dto = purchaseObjectMapper.toDto(requestVo, userInfoVo);

        // ì¶”ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ í•„ë“œ ì„¸íŒ…
        return PurchaseDto.builder()
                .userId(dto.getUserId())
                .productId(dto.getProductId())
                .username(dto.getUsername())
                .membershipLevel(dto.getMembershipLevel())
                .purchaseStatus("REQUESTED") // ì¶”ê°€ ê°€ê³µ
                .build();
    }
}
```

âœ… MapStructë¡œ ê¸°ë³¸ í•„ë“œ ë³€í™˜í•˜ê³ , ì¶”ê°€ í•„ë“œëŠ” Builderë¥¼ ì´ìš©í•´ ì±„ì›Œì¤ë‹ˆë‹¤.

---

# ğŸ¯ ìš”ì•½

| í•­ëª© | ì„¤ëª… |
|:---|:---|
| **ë³µí•© ë§¤í•‘** | í•˜ë‚˜ì˜ Mapper ë©”ì„œë“œì— ì—¬ëŸ¬ source ê°ì²´ë¥¼ ë„˜ê²¨ì¤€ë‹¤. |
| **@Mappingìœ¼ë¡œ í•„ë“œ ì—°ê²°** | source â†’ target ëª…í™•íˆ ì§€ì • |
| **ì¶”ê°€ ê°€ê³µ í•„ë“œ** | MapStruct ì™¸ë¶€ì—ì„œ ë³„ë„ë¡œ Builderë‚˜ Setterë¡œ ì¶”ê°€ |

---

# ğŸ“¦ í•œ ì¥ ê·¸ë¦¼ìœ¼ë¡œ

```plaintext
PurchaseRequestVo (Kafka) +
UserInfoVo (DB ì¡°íšŒ)
â†“ (MapStruct)
PurchaseDto (ë¹„ì¦ˆë‹ˆìŠ¤ DTO)
â†“ (Builderë¡œ ì¶”ê°€ í•„ë“œ ë³´ì™„)
â†“
Entity ë³€í™˜ â†’ DB ì €ì¥
```

---

# âœ… ìµœì¢… ì •ë¦¬ ë¬¸ì¥

> **MapStructëŠ” ì—¬ëŸ¬ VOë¥¼ ë™ì‹œì— ë°›ì•„ í•˜ë‚˜ì˜ DTOë¡œ ë³€í™˜í•  ìˆ˜ ìˆê³ ,  
> í•„ìš”í•œ ì¶”ê°€ í•„ë“œëŠ” Builderë‚˜ ìˆ˜ë™ ì„¸íŒ…ìœ¼ë¡œ ë³´ì™„í•  ìˆ˜ ìˆë‹¤.**

---

============================================================================================================

ì¢‹ìŠµë‹ˆë‹¤! ğŸ”¥ğŸ”¥  
ì´ë²ˆì—ëŠ” ì•½ì†ëŒ€ë¡œ **ë³µí•© VO ë§¤í•‘í•˜ë©´ì„œ ì¤‘ê°„ì— ë°ì´í„° ê°€ê³µí•˜ëŠ” ê³ ê¸‰ MapStruct ì˜ˆì œ**ë¥¼ ì™„ì „ ì‹¤ì „ì²˜ëŸ¼ ë§Œë“¤ì–´ ë³´ì—¬ë“œë¦´ê²Œìš”.

---

# ğŸŒŸ ëª©í‘œ
- ì—¬ëŸ¬ VO (Kafka ìˆ˜ì‹  + DB ì¡°íšŒ ê²°ê³¼)ë¥¼ MapStructë¡œ ì¡°í•©
- ë§¤í•‘ ê³¼ì •ì—ì„œ **ë¬¸ìì—´ í•©ì¹˜ê¸°**, **ê°€ê³µ**, **í¬ë§·íŒ…** ê°™ì€ ì¶”ê°€ ë¡œì§ë„ ë„£ê¸°
- Builder ì—†ì´ **MapStruct ë‚´ë¶€ì—ì„œ ë‹¤ ì²˜ë¦¬í•˜ê¸°**

---

# ğŸ“š ì˜ˆì œ ì„¤ì •

**ìˆ˜ì‹  ë°ì´í„° 1: PurchaseRequestVo (Kafka)**

```java
@Getter
@AllArgsConstructor
public class PurchaseRequestVo {
    private final Long userId;
    private final Long productId;
}
```

---

**ì¡°íšŒ ë°ì´í„° 2: UserInfoVo (DB ì¡°íšŒ)**

```java
@Getter
@AllArgsConstructor
public class UserInfoVo {
    private final String username;
    private final String membershipLevel;
}
```

---

**ìµœì¢… ëª©ì ì§€ DTO: PurchaseDto**

```java
@Getter
@Builder
public class PurchaseDto {
    private final Long userId;
    private final Long productId;
    private final String userInfoSummary; // ğŸ’¥ username + (membershipLevel) í•©ì³ì„œ í‘œí˜„
    private final String purchaseStatus;  // ğŸ’¥ ê¸°ë³¸ê°’ "REQUESTED"
}
```

---

# ğŸ› ï¸ MapStruct Mapper ì„¤ê³„

**PurchaseObjectMapper.java**

```java
package com.example.mapper;

import com.example.dto.PurchaseDto;
import com.example.vo.PurchaseRequestVo;
import com.example.vo.UserInfoVo;
import org.mapstruct.Mapper;
import org.mapstruct.Mapping;
import org.mapstruct.Mappings;
import org.mapstruct.factory.Mappers;

@Mapper(componentModel = "spring")
public interface PurchaseObjectMapper {

    PurchaseObjectMapper INSTANCE = Mappers.getMapper(PurchaseObjectMapper.class);

    @Mappings({
        @Mapping(source = "purchaseRequestVo.userId", target = "userId"),
        @Mapping(source = "purchaseRequestVo.productId", target = "productId"),
        @Mapping(target = "userInfoSummary", expression = "java(buildUserInfoSummary(userInfoVo))"), // ğŸ’¥ ì‚¬ìš©ì ì •ë³´ ìš”ì•½ ë¬¸ìì—´
        @Mapping(target = "purchaseStatus", constant = "REQUESTED") // ğŸ’¥ ê³ ì •ê°’ ì„¸íŒ…
    })
    PurchaseDto toDto(PurchaseRequestVo purchaseRequestVo, UserInfoVo userInfoVo);

    // ğŸ’¬ ë¬¸ìì—´ í•©ì¹˜ê¸° ê°€ê³µ ë¡œì§
    default String buildUserInfoSummary(UserInfoVo userInfoVo) {
        if (userInfoVo == null) {
            return "Unknown User";
        }
        return userInfoVo.getUsername() + " (" + userInfoVo.getMembershipLevel() + ")";
    }
}
```

âœ… ì—¬ê¸°ì„œ **í•µì‹¬ í¬ì¸íŠ¸**
- `expression = "java(ë©”ì†Œë“œí˜¸ì¶œ)"`  
- `constant = "ë¬¸ìì—´"`  
- `default ë©”ì†Œë“œ`ë¥¼ í†µí•´ í•„ìš”í•œ ë¡œì§ì„ ë”°ë¡œ ëº„ ìˆ˜ ìˆìŒ

---

# ğŸ”¥ íë¦„ ìš”ì•½

```plaintext
PurchaseRequestVo (Kafka)
+
UserInfoVo (DB ì¡°íšŒ)

â†“ (MapStruct ë§¤í•‘ ì¤‘)
- userInfoSummary = username + (membershipLevel)
- purchaseStatus = "REQUESTED" ê³ ì •

â†“
PurchaseDto ì™„ì„±
```

---

# ğŸ¯ ì‹¤ì œ Service ì‚¬ìš© ì˜ˆì‹œ

```java
@Service
@RequiredArgsConstructor
public class PurchaseService {

    private final PurchaseObjectMapper purchaseObjectMapper;

    public PurchaseDto buildPurchaseDto(PurchaseRequestVo requestVo, UserInfoVo userInfoVo) {
        return purchaseObjectMapper.toDto(requestVo, userInfoVo);
    }
}
```

âœ… Builderë¡œ ë‹¤ì‹œ ì†ëŒˆ í•„ìš” ì—†ì´ í•œë°©ì— DTO ì™„ì„±!

---

# ğŸ“¦ ì—¬ê¸°ì„œ ì“°ì¸ MapStruct ê¸°ëŠ¥ ìš”ì•½

| ê¸°ëŠ¥ | ì‚¬ìš©ë²• | ì„¤ëª… |
|:---|:---|:---|
| **expression** | `expression = "java(ë©”ì†Œë“œ í˜¸ì¶œ)"` | ë§¤í•‘ ì¤‘ ê°€ê³µ, ë³€í™˜ ì‘ì—…ì„ ì§ì ‘ ë„£ìŒ |
| **constant** | `constant = "ê°’"` | DTO í•„ë“œì— ê³ ì •ê°’ ì„¸íŒ… |
| **default method** | `default String ë©”ì†Œë“œ(...)` | ë³µì¡í•œ ê°€ê³µ ë¡œì§ì„ Mapper ì•ˆì— ë”°ë¡œ ëºŒ |

---

# âœ… ì •ë¦¬ ë¬¸ì¥

> **MapStructëŠ” ì—¬ëŸ¬ VOë¥¼ í•©ì³ì„œ í•˜ë‚˜ì˜ DTOë¡œ ë§Œë“¤ë©´ì„œ,  
> ì¤‘ê°„ì— ë¬¸ìì—´ ê°€ê³µ, ê°’ ë³€í™˜, ê¸°ë³¸ê°’ ì„¸íŒ…ê¹Œì§€ ê¹”ë”í•˜ê²Œ ìë™ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.**

---

# â¡ï¸ ì´ ë‹¤ìŒ ì‹¬í™”ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ì£¼ì œ

- MapStruct `@Context`ë¥¼ ì´ìš©í•´ì„œ ë§¤í•‘ ì¤‘ ì™¸ë¶€ ì„œë¹„ìŠ¤ í˜¸ì¶œí•˜ê¸°
- ì»¬ë ‰ì…˜(List<VO>) â†’ List<DTO> ë³€í™˜ ë§¤í•‘í•˜ê¸°
- ë³µí•© ë§¤í•‘ + null-safe ì²˜ë¦¬ + defaultExpression ê³ ê¸‰ í†µí•© ì˜ˆì œ
